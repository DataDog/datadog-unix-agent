{% set agent = status.get('agent', {}) %}
{% set dogstatsd = status.get('dogstatsd', {}) %}
{{ '='*"DataDog Unix Agent (v{})".format(version)|length }}
DataDog Unix Agent (v{{ version }})
{{ '='*"DataDog Unix Agent (v{})".format(version)|length }}

  Pid: {{ agent.get('pid') }}
  Python Version: {{ agent.get('python_version')  }}
  Log Level: {{ agent.get('log_level') }}

Host Info
=========
  Hostname: {{ agent.get('hostname') }}
  Hostname (collected): {{ agent.get('hostname_native') }}

Clock
=====
  Agent uptime: {{ agent.get('uptime') }}s
  System UTC time: {{ agent.get('utc_time') }}

Configuration
=============
  Agent Config: {{ agent.get('agent_config_path')  }}
  Agent Logs: {{ agent.get('agent_log_path') }}

Running Checks
==============
{% if agent.get('checks', {})|length > 0 -%}
{% for check, stats in agent.get('checks', {}).items() %}
  - {{ check }}
    {{ '-'*check|length }}
    metrics: {{ stats.get('metrics', 0) }}
    events: {{ stats.get('events', 0) }}
    service checks: {{ stats.get('service_checks', 0) }}
{% endfor -%}
{% else -%}
  There are currently no running checks.
{% endif -%}
{% for check, errors in status.get('errors').get('runtime', {}).items() %}
  - {{ check }}
    {{ '-'*check|length }}
    {% for instance, error in errors.items() -%}
    instance ({{ instance }}):

        Error: {{ error.get('message') }}

        {{ error.get('traceback', '')|indent(width=10) }}
    {% endfor %}
{% endfor -%}
  Last Flush Metric Count: {{ agent.get('last_metric_pkt_count') }}
  Last Flush Event Count: {{ agent.get('last_event_pkt_count')}}
  Last Flush Service Check Count: {{ agent.get('last_service_check_pkt_count')}}
  Total Metric Count: {{ agent.get('total_metric_pkt_count') }}
  Total Event Count: {{ agent.get('total_event_pkt_count')}}
  Total Service Check Count: {{ agent.get('total_service_check_pkt_count')}}

{% if status.get('errors').get('loader', {})|length > 0 -%}
Errors
======
{% for check, errors in status.get('errors').get('loader', {}).items() %}
  - {{ check }}
    {{ '-'*check|length }}
    {% for loader, error in errors.items() -%}
      {{ loader }}: {{ error }}
    {% endfor -%}
{% endfor -%}
{% endif %}

{% if dogstatsd|length > 0 -%}
Dogstatsd
=========
  Last Flush Metric Count: {{ dogstatsd.get('last_metric_pkt_count') }}
  Last Flush Event Count: {{ dogstatsd.get('last_event_pkt_count')}}
  Last Flush Service Check Count: {{ dogstatsd.get('last_service_check_pkt_count')}}
  Total Metric Count: {{ dogstatsd.get('total_metric_pkt_count') }}
  Total Event Count: {{ dogstatsd.get('total_event_pkt_count')}}
  Total Service Check Count: {{ dogstatsd.get('total_service_check_pkt_count')}}
{% endif -%}

API Key Status
  API Key ending in {{ agent.get('redacted_api') }}: {{ agent.get('api_status') }}

